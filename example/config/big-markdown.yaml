---
content: "# TESTING PATH Base Arch Install\n\n## Prepare LCD\n\n```zsh\n# Add Remote Server\nlxc remote add paddi 10.172.31.254:8843\n# Set Remote to be Deafult\nlxc remote set-default paddi\n# Create OVS Switch\nlxc network create ovsbr0 bridge.driver=openvswitch\n```\n\n## Install Base Image from the Internet\n\n```zsh\nlxc image copy --alias=arch  images:archlinux paddi:\n# or\nlxc image copy images:archlinux local: --alias arch-remote --auto-update\nlxc init arch name.goes.here\nlxc start name.goes.here\n\n```\n\n## Install Base Image from local tarball\n\n---\n\n## Configure Base Arch Image\n\n### Add zsh config files\n\n```zsh\n\npacman -Sy --needed --noconfirm\npacman --needed --noconfirm -S base-devel\npacman --needed --noconfirm -S zsh bridge-utils psmisc vim git tree rsync bc wget tmux lsof\npacman --needed --noconfirm -S ctags sudo python perl btrfs-progs ebtables\npacman --needed --noconfirm -S cmake\n\ngit clone --recurse-submodules --recursive --config http.sslVerify=false https://bitbucket.org/pSox/psoxizsh.git /etc/psoxizsh\ncd /etc/psoxizsh\ngit checkout develop\ncd\ncat <<ZSHRC >/etc/skel/.zshrc\n\nexport TERM=xterm-256color\n\n# Added by psoxizsh\ngrep -qE . ~/.psoxizsh/zshrc 2>>/dev/null && source ~/.psoxizsh/zshrc || source /etc/psoxizsh/zshrc\n\nZSHRC\ncp -v /etc/skel/.zshrc  ~\nuseradd -D -s /bin/zsh\nuseradd -D\nchsh -s /bin/zsh\ninstall -v --mode=700 -d ~/.ssh\ninstall -v --mode=700 -d /etc/skel/.ssh\nsu -\n\n```\n\nIf you seed the new zsh prompt then logout and log back in.\n\n### Install vim plugins\n\n```zsh\nvim -c PlugInstall -c qa\n\n```\n\n### Add pacman User\n\n```zsh\nuseradd -u 9696 -m -G wheel -d /usr/local/pacman -s /usr/bin/zsh pacman\ncat <<SUDO >/etc/sudoers.d/50_pacman\npacman ALL=(ALL) NOPASSWD: ALL\nSUDO\nchmod 600 /etc/sudoers.d/50_pacman\n```\n\n### Add custom User\n\n```zsh\n(\nexport USER_NAME=pstemmet\nuseradd \\\n  -m \\\n  -G wheel,users \\\n  -s /usr/bin/zsh \\\n  -p '$6$eJCeHI42MBP60yVF$yisIsRVGkscfLZi93pdCAMRFtCY5TSzjvyAWPlibx3gwypqkIjTM7E9MFNOr8QASxkfQ6AvnUwFDLZ.VqWpIE' \\\n  ${USER_NAME}\ncat <<SUDO >/etc/sudoers.d/50_${USER_NAME}\n${USER_NAME} ALL=(ALL) NOPASSWD: ALL\nSUDO\nchmod 600 /etc/sudoers.d/50_${USER_NAME}\n)\n\n```\n\n### Add and Configure Package Managers\n\n```zsh\nsudo -iupacman mkdir -vp .cache/yay/yay-bin\ncurl https://aur.archlinux.org/cgit/aur.git/plain/PKGBUILD?h=yay-bin | sudo -iupacman tee .cache/yay/yay-bin/PKGBUILD\nsudo -iupacman zsh -c \"cd .cache/yay/yay-bin; makepkg\"\npacman -U ~pacman/.cache/yay/yay-bin/yay-bin*.pkg.tar.xz --noconfirm\nsudo -iupacman yay -S yaourt --noconfirm --needed\n\n```\n\n## LXD Config\n\n### Install LXD\n\n```zsh\nyay -S --needed --noconfirm lxd\nsystemctl enable lxd.socket\nsystemctl start  lxd.socket\n\n```\n\n### Configure LXD\n\n```zsh\nsed -i -E 's|^#?Domains=.*|Domains=lxpad.int|' /etc/systemd/resolved.conf\nsystemctl restart systemd-resolved.service\nhostnamectl set-hostname $(hostname -s).lxpad.int\n\nsysctl -w net.ipv6.conf.all.disable_ipv6=1\ncat <<NO_IPV6  >/etc/sysctl.d/10-no-ipv6.conf\nnet.ipv6.conf.all.disable_ipv6 = 1\nNO_IPV6\nsed -i -E \"s/(^[0-9.]+\\s+$(hostname -s).*)/# DON'T TOUCH : \\1/\" /etc/hosts\nlxd init\n\n```\n\n### Update Default Profile\n\n* Add the following to the default profile using the `lxc profile edit default` command.\n\n* Do not modify the `name:` and `used_by:` tags.\n\n```yaml\nconfig:\n  boot.autostart: \"true\"\n  linux.kernel_modules: bridge,br_netfilter,ip_tables,ip6_tables,netlink_diag,nf_nat,overlay,ebtable_broute,openvswitch\n  raw.lxc: |-\n    lxc.apparmor.profile=unconfined\n    lxc.cgroup.devices.allow = a\n    lxc.mount.auto=proc:rw sys:rw\n    lxc.cap.drop =\n  security.nesting: \"true\"\n  security.privileged: \"true\"\ndevices:\n  mem:\n    path: /dev/mem\n    type: unix-char\n  root:\n    path: /\n    pool: paddi-store\n    type: disk\n```\n\n### LXD OpenVSwitch Config\n\n```zsh\n# lxc network create ovs01 bridge.driver=openvswitch\n# lxc network create ovs00 bridge.driver=openvswitch ipv4.address=\"172.30.33.254/23\" ipv4.nat=true ipv6.address=\"fd00:cafe:1::ffff/64\" ipv6.nat=true\n```\n\n### LXD 3.0.0 Renamed Configs\n\n| Legacy Key               | New Key                       | Comments |\n| ------------------------ | ----------------------------- | -------- |\n| lxc.aa_profile           | lxc.apparmor.profile          |\n| lxc.aa_allow_incomplete  | lxc.apparmor.allow_incomplete |\n| lxc.console              | lxc.console.path              |\n| lxc.devttydir            | lxc.tty.dir                   |\n| lxc.haltsignal           | lxc.signal.halt               |\n| lxc.id_map               | lxc.idmap                     |\n| lxc.init_cmd             | lxc.init.cmd                  |\n| lxc.init_gid             | lxc.init.gid                  |\n| lxc.init_uid             | lxc.init.uid                  |\n| lxc.kmsg                 | -                             | removed  |\n| lxc.limit                | lxc.prlimit                   |\n| lxc.logfile              | lxc.log.file                  |\n| lxc.loglevel             | lxc.log.level                 |\n| lxc.mount                | lxc.mount.fstab               |\n| lxc.network              | lxc.net                       |\n| lxc.network.             | lxc.net.[i].                  |\n| lxc.network.flags        | lxc.net.[i].flags             |\n| lxc.network.hwaddr       | lxc.net.[i].hwaddr            |\n| lxc.network.ipv4         | lxc.net.[i].ipv4.address      |\n| lxc.network.ipv4.gateway | lxc.net.[i].ipv4.gateway      |\n| lxc.network.ipv6         | lxc.net.[i].ipv6.address      |\n| lxc.network.ipv6.gateway | lxc.net.[i].ipv6.gateway      |\n| lxc.network.link         | lxc.net.[i].link              |\n| lxc.network.macvlan.mode | lxc.net.[i].macvlan.mode      |\n| lxc.network.mtu          | lxc.net.[i].mtu               |\n| lxc.network.name         | lxc.net.[i].name              |\n| lxc.network.script.down  | lxc.net.[i].script.down       |\n| lxc.network.script.up    | lxc.net.[i].script.up         |\n| lxc.network.type         | lxc.net.[i].type              |\n| lxc.network.veth.pair    | lxc.net.[i].veth.pair         |\n| lxc.network.vlan.id      | lxc.net.[i].vlan.id           |\n| lxc.pivotdir             | -                             | removed  |\n| lxc.pts                  | lxc.pty.max                   |\n| lxc.rebootsignal         | lxc.signal.reboot             |\n| lxc.rootfs               | lxc.rootfs.path               |\n| lxc.se_context           | lxc.selinux.context           |\n| lxc.seccomp              | lxc.seccomp.profile           |\n| lxc.stopsignal           | lxc.signal.stop               |\n| lxc.syslog               | lxc.log.syslog                |\n| lxc.tty                  | lxc.tty.max                   |\n| lxc.utsname              | lxc.uts.name                  |\n"